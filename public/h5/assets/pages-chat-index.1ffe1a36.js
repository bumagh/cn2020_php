import{j as e,x as n,k as o,B as r,D as t,l as i,o as a,c as s,w as l,i as u,f as d,a as p,b as w,F as c,p as f}from"./index-be7fe8a3.js";import{_ as g}from"./uni-list-chat.0ac62b4d.js";import{r as m}from"./uni-app.es.63fa007f.js";import{_ as h}from"./uni-list.d1919617.js";import{p as _,c as b}from"./util.ff018e21.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";const y=k({data:()=>({myInfo:{},group:{room:[],news:{},uinfo:{}},friend:{news:[],uinfo:{}},localGroupNews:{},localFriendNews:{},upUrl:""}),onLoad(n){this.upUrl=e().globalData.upUrl,this.myInfo=e().globalData.myAuth},onShow:function(){e().globalData.myAuth.uid?(this.myInfo=e().globalData.myAuth,this.getRoomList()):n({url:"/pages/member/index"})},onHide:function(){},methods:{clickChatList(e,n,r){o({url:"/pages/chat/chat?type="+e+"&rid="+n+"&title="+r})},getRoomList(){let n=this;_(e().globalData.eyUrl+"chat/getRoom",{}).then((e=>{let o=e.data;if("1"==o.code){if(n.group.room=o.group.room?o.group.room:{},n.group.uinfo=o.group.uinfo?o.group.uinfo:{},n.group.news=o.group.news?o.group.news:{},n.group.news){let e=r("localGroupNews")||{};for(var a in n.group.news)for(var s in e.hasOwnProperty(a)?e[a].isnew=e[a].created_at<=n.group.news[a].created_at:(e[a]={},e[a].created_at=n.group.news[a].created_at,e[a].isnew=!0),n.group.news[a].isnew=e[a].isnew,n.group.room){if(n.group.news[n.group.room[s].rid]&&1==n.group.news[n.group.room[s].rid].isnew){n.group.room[s].isnew=!0;break}n.group.room[s].isnew=!1}t("localGroupNews",e),n.group.room.sort(b("isnew","-"))}if(o.friend.news){n.friend.news=[];let e,i=r("localFriendNews")||{};for(let r in o.friend.news)i.hasOwnProperty(r)?i[r].isnew=i[r].created_at<=o.friend.news[r].created_at:(i[r]={},i[r].created_at=o.friend.news[r].created_at,i[r].isnew=!0),e=o.friend.news[r].uid==n.myInfo.uid?o.friend.news[r].fid:o.friend.news[r].uid,o.friend.news[r].isnew=i[r].isnew,o.friend.news[r].oid=e,o.friend.news[r].name=o.friend.uinfo[e].name,o.friend.news[r].avatar=o.friend.uinfo[e].avatar,n.friend.news.push(o.friend.news[r]);n.friend.news.sort(b("isnew","-")),t("localFriendNews",i)}}else i({icon:"none",title:o.msg})}))}}},[["render",function(e,n,o,r,t,i){const _=m(f("uni-list-chat"),g),b=m(f("uni-list"),h),k=u;return a(),s(k,{class:"container"},{default:l((()=>[d(b,null,{default:l((()=>[d(b,{border:!0},{default:l((()=>[(a(!0),p(c,null,w(t.group.room,((e,n)=>(a(),s(_,{key:n,clickable:"",onClick:n=>i.clickChatList("group",e.rid,e.title),title:e.title,avatar:"/static/chat.png",note:t.group.news[e.rid]?"img"==t.group.news[e.rid].tag?"[图片]":t.group.news[e.rid].content:"",time:"","badge-text":!(!t.group.news[e.rid]||!t.group.news[e.rid].isnew)&&"dot"},null,8,["onClick","title","note","badge-text"])))),128)),(a(!0),p(c,null,w(t.friend.news,((e,n)=>(a(),s(_,{key:n,clickable:"",onClick:n=>i.clickChatList("friend",e.oid,e.name),"avatar-circle":!0,title:e.name,avatar:t.upUrl+e.avatar,note:"img"==e.tag?"[图片]":e.content,time:e.created_at,"badge-text":!!e.isnew&&"dot"},null,8,["onClick","title","avatar","note","time","badge-text"])))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-c7ba305d"]]);export{y as default};
