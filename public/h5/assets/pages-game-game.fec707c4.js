import{a9 as e,p as t,o as a,c as s,w as l,f as i,a as n,F as o,b as u,e as r,n as d,a5 as c,i as m,j as h,B as p,x as g,D as f,l as y,aj as _,y as M,g as b,d as x,h as v,v as k,S,t as C,u as I,z as q}from"./index-be7fe8a3.js";import{_ as E}from"./uni-badge.81b1303d.js";import{r as w}from"./uni-app.es.63fa007f.js";import{_ as B,a as z}from"./uni-row.3ae7a9d0.js";import{_ as D}from"./uni-icons.43709c62.js";import{_ as P}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as j}from"./uni-tag.d4975b95.js";import{_ as R}from"./uni-title.5e3efb52.js";import{_ as U,a as N}from"./uni-grid.e93a140d.js";import{_ as L}from"./uni-segmented-control.a6ae5887.js";import{_ as A}from"./uni-pagination.b2603419.js";import{_ as T}from"./uni-fab.ad1d44b0.js";import{p as V}from"./util.ff018e21.js";import{_ as F}from"./btn-make.9908e8bd.js";const X=P({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],a=Math.floor(e),s=Math.ceil(e);for(let l=0;l<this.max;l++)a>l?t.push({activeWitch:"100%"}):s-1===l?t.push({activeWitch:100*(e-a)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:a}=e.changedTouches[0];this._getRateCount(t||a)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0;for(let s=0;s<t.length-1;s++)if(e.indexOf(t[s])>0){a=!1;break}return a},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const a=e-this._rateBoxLeft;let s=parseInt(a/(t+this.marginNumber));s=s<0?0:s,s=s>this.max?this.max:s;const l=parseInt(a-(t+this.marginNumber)*s);let i=0;(this._oldValue!==s||this.PC)&&(this._oldValue=s,i=this.allowHalf?l>t/2?s+1:s+.5:s+1,i=Math.max(.5,Math.min(i,this.max)),this.valueSync=i,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}},[["render",function(e,h,p,g,f,y){const _=w(t("uni-icons"),D),M=m;return a(),s(M,null,{default:l((()=>[i(M,{ref:"uni-rate",class:"uni-rate"},{default:l((()=>[(a(!0),n(o,null,u(y.stars,((e,t)=>(a(),s(M,{class:r(["uni-rate__icon",{"uni-cursor-not-allowed":p.disabled}]),style:d({"margin-right":y.marginNumber+"px"}),key:t,onTouchstart:c(y.touchstart,["stop"]),onTouchmove:c(y.touchmove,["stop"]),onMousedown:c(y.mousedown,["stop"]),onMousemove:c(y.mousemove,["stop"]),onMouseleave:y.mouseleave},{default:l((()=>[i(_,{color:p.color,size:p.size,type:p.isFill?"star-filled":"star"},null,8,["color","size","type"]),i(M,{style:d({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:l((()=>[i(_,{color:p.disabled?p.disabledColor:p.activeColor,size:p.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-06ce50f7"]]);const W=P({mounted(){e().select(".ey-bottom").boundingClientRect((e=>{this.page.height=e.top-2})).exec()},data:()=>({upUrl:"",page:{},myInfo:{},myPocket:{},baseModules:[],myModules:[],myStoreList:{},baseConf:[0,1,2,3,4,5,6,7,8,9,10,11],myEquip:{},tempEquip:{},swiperIndex:0,sale:{cateid:0,cate:[],data:[],count:0,page:0,limit:10},totalConf:[],menu:{item:["时空堡垒","战斗配置","仓库","AI对决","交易大厅"],current:0,height:50},actMenu:h().globalData.actMenu}),onLoad(e){this.page=h().globalData.page,this.page.height=parseInt(this.page.height)-parseInt(this.menu.height),this.myInfo=p("myAuth")},onShow:function(){this.myInfo.uid?(h().globalData.myAuth=this.myInfo,this.getBaseModules()):g({url:"/pages/member/index"}),this.baseModules=p("game_modules")},methods:{clickActMenu(e){g({url:this.actMenu[e.index].route})},selectEquip(e){this.tempEquip.sort=e,this.swiperIndex=1},setEquipConf(){let e=this,t=this.tempEquip;V(h().globalData.eyUrl+"game/setEquip",t).then((t=>{let a=t.data;"1"==a.code?(e.myEquip=a.equip,f("game_myequip",a.equip),f("game_mymodules",a.modules),e.renderMyModules(),e.swiperIndex=0,e.tempEquip.sort=-1):y({icon:"none",title:a.msg})}))},delEquipConf(e){let t=this,a={};a.sort=e,a.obj=this.myEquip[e],V(h().globalData.eyUrl+"game/delEquip",a).then((e=>{let a=e.data;"1"==a.code?(t.myEquip=a.equip,f("game_myequip",a.equip),f("game_mymodules",a.modules),t.renderMyModules()):y({icon:"none",title:a.msg})}))},clickSelectModule(e){var t=this;this.tempEquip.obj=e,this.tempEquip.sort>=0?this.setEquipConf():_({itemList:["出售1份该模块","回收1份该模块"],success:function(e){0==e.tapIndex?M({title:"出售1份该模块",editable:!0,placeholderText:"输入模块价格(单位:金币)",success:function(e){e.confirm?(t.tempEquip.obj.coin=e.content,t.setModuleSale(t.tempEquip.obj)):e.cancel},complete:function(){}}):M({title:"回收1份该模块",content:"回收后将返还当前模块的95%资源",success:function(e){e.confirm?t.setModuleReturn(t.tempEquip.obj):e.cancel},complete:function(){}})},fail:function(e){}})},clickEquipConf(e){var t=this,a=e;t.myEquip[a]?M({title:"提示",content:"是否卸下配置的模块",success:function(e){e.confirm?t.delEquipConf(a):e.cancel},complete:function(){t.setAIConfInit()}}):setTimeout((function(){t.selectEquip(a)}),100)},getEquipData(){let e=this;V(h().globalData.eyUrl+"game/getEquip",{}).then((t=>{let a=t.data;"1"==a.code?(e.myEquip=a.data,f("game_myequip",a.data)):y({icon:"none",title:a.msg})}))},getBaseModules(){let e=this;V(h().globalData.eyUrl+"game/getModulesBase",{}).then((t=>{let a=t.data;"1"==a.code?(e.baseModules=a.data,e.myPocket=a.pocket,f("game_modules",a.data)):y({icon:"none",title:a.msg})}))},clickSaleModule(e){const t=this,a=this.sale.data[e];a&&(a.uid==t.myInfo.uid?M({title:"回购出售的模块吗？",success:function(a){a.confirm?t.setModuleBuyBack(e):a.cancel}}):M({title:"购买此模块吗?",content:"将消耗"+a.coin+"金币",success:function(a){a.confirm?t.setModuleBuy(e):a.cancel}}))},setModuleBuy(e){let t=this,a={};a=this.sale.data[e],V(h().globalData.eyUrl+"game/buyModule",a).then((a=>{let s=a.data;"1"==s.code?(t.sale.data.splice(e,1),f("game_mymodules",s.data),y({icon:"success",title:"购买成功！"}),t.renderMyModules()):y({icon:"none",title:s.msg})}))},setModuleReturn(e){let t=this,a=e;V(h().globalData.eyUrl+"game/buyReturnModule",a).then((e=>{let a=e.data;console.log("ret=>",JSON.stringify(a)),"1"==a.code?(f("game_mymodules",a.data),y({icon:"success",title:"回收成功！"}),t.renderMyModules()):y({icon:"none",title:a.msg})}))},setModuleBuyBack(e){let t=this,a={};a=this.sale.data[e],V(h().globalData.eyUrl+"game/buyBackModule",a).then((a=>{let s=a.data;"1"==s.code?(t.sale.data.splice(e,1),f("game_mymodules",s.data),y({icon:"success",title:"回购成功！"}),t.renderMyModules()):y({icon:"none",title:s.msg})}))},setModuleSale(e){let t=this,a={};a=e,V(h().globalData.eyUrl+"game/setModuleSale",a).then((e=>{let a=e.data;"1"==a.code?(f("game_mymodules",a.data),y({icon:"none",title:"模块出售中"}),t.renderMyModules()):y({icon:"none",title:a.msg})}))},setModuleMakeSure(e){const t=this;M({title:"确认要制造该模块吗？",content:"制造该模块将消耗资源:"+100*Math.pow(10,e.lvl),success:function(a){a.confirm?t.setModuleMake(e):a.cancel}})},setModuleMake(e){let t=this,a={};a=e,V(h().globalData.eyUrl+"game/setModuleMake",a).then((e=>{let a=e.data;"1"==a.code?(t.myPocket=a.pocket,f("game_mymodules",a.data),y({icon:"none",title:"模块制造成功"})):y({icon:"none",title:a.msg})}))},setModuleUpgradeSure(e){const t=this;M({title:"确认要升级该模块吗？",content:"消耗金币:"+100*e.lvl+",资源:"+1e3*Math.pow(10,e.lvl),success:function(a){a.confirm?t.setModuleUpgrade(e):a.cancel}})},setModuleUpgrade(e){let t=this,a={};a=e,V(h().globalData.eyUrl+"game/setModuleUpgrade",a).then((e=>{let a=e.data;"1"==a.code?(t.baseModules=a.data,t.myPocket=a.pocket,y({icon:"none",title:"模块升级成功"})):y({icon:"none",title:a.msg})}))},getModuleInfoById(e){for(var t in this.baseModules)if(this.baseModules[t].id==e)return this.baseModules[t];return{}},setAIConfInit(){this.swiperIndex=0,this.tempEquip.sort=-1,this.sale.cateid=0},renderMyModules(){this.myModules=[],this.totalConf=[],this.myStoreList={};const e=p("game_mymodules");var t={};for(var a in e)"0"!=e[a].lvl&&(t=this.getModuleInfoById(e[a].mid)).id&&(e[a].name=t.name,e[a].avatar=t.avatar,this.myModules.push(e[a]),this.myStoreList[t.id]||(this.myStoreList[t.id]=[]),this.myStoreList[t.id].push(e[a]));const s=p("game_myequip");for(var l=1;l<=7;l++)for(var a in this.totalConf[l]=1e3,s)this.totalConf[s[a].mid]=this.totalConf[s[a].mid]+1e3*s[a].lvl*10/100},getSaleDataByCate(e){this.sale.page=0,this.sale.cateid=e.currentIndex,this.renderSaleModules()},getSaleData(e){this.sale.page=e.current,this.renderSaleModules()},renderSaleModules(){let e=this,t={};t.cateid=this.sale.cateid+1,t.page=this.sale.page,V(h().globalData.eyUrl+"game/getSaleModules",t).then((t=>{let a=t.data;if(e.sale.data=[],"1"==a.code){p("game_modules");var s={};for(var l in e.sale.count=a.count,e.sale.limit=a.limit,e.sale.page=a.page,a.data)(s=e.getModuleInfoById(a.data[l].mid)).id&&(a.data[l].name=s.name,a.data[l].avatar=s.avatar,e.sale.data.push(a.data[l]))}else y({icon:"none",title:a.msg})}))},onClickMenuItem(e){if(this.menu.current!==e.currentIndex)if(this.menu.current=e.currentIndex,this.setAIConfInit(),0==this.menu.current){let e=this,t={};V(h().globalData.eyUrl+"game/getMyPocket",t).then((t=>{let a=t.data;"1"==a.code?e.myPocket=a.pocket:y({icon:"none",title:a.msg})}))}else if(1==this.menu.current)this.renderMyModules(),this.getEquipData();else if(2==this.menu.current)0==this.myModules.length&&this.renderMyModules(),this.swiperIndex=1,this.tempEquip.sort=-1;else if(4==this.menu.current){if(0==this.sale.cate.length)for(var t in this.baseModules)this.sale.cate.push(this.baseModules[t].name);this.renderSaleModules(1)}}}},[["render",function(e,r,c,h,p,g){const f=I,y=w(t("uni-badge"),E),_=w(t("uni-col"),B),M=w(t("uni-rate"),X),D=v,P=m,V=w(t("uni-row"),z),W=w(t("uni-tag"),j),H=w(t("uni-title"),R),O=w(t("uni-grid-item"),U),$=w(t("uni-grid"),N),J=k,G=S,K=w(t("uni-segmented-control"),L),Q=q,Y=w(t("uni-pagination"),A),Z=w(t("uni-fab"),T);return a(),s(P,null,{default:l((()=>[i(P,{class:"content"},{default:l((()=>[0===p.menu.current?(a(),s(P,{key:0,class:"ey-base",style:d("max-height:"+p.page.height+"px;height:"+p.page.height+"px;")},{default:l((()=>[(a(!0),n(o,null,u(p.baseModules,((e,t)=>(a(),s(V,{key:t},{default:l((()=>[i(_,{span:6},{default:l((()=>[i(y,{style:{"margin-left":"10px","margin-top":"10px"},text:"等级:"+(e.lvl?e.lvl:0),absolute:"rightBottom",offset:[32,15]},{default:l((()=>[i(f,{class:"btn-image",src:"/static/game/"+e.avatar},null,8,["src"])])),_:2},1032,["text"])])),_:2},1024),i(_,{span:8},{default:l((()=>[i(M,{style:{"margin-top":"30px"},readonly:!0,value:e.lvl?e.lvl:0},null,8,["value"])])),_:2},1024),i(_,{span:5},{default:l((()=>[i(P,{onClick:t=>g.setModuleUpgradeSure(e),style:{position:"relative","margin-top":"10px"}},{default:l((()=>[i(f,{class:"btn-image",src:F}),i(D,{class:"btn-text"},{default:l((()=>[b("升级")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),i(_,{span:5},{default:l((()=>[i(P,{onClick:t=>g.setModuleMakeSure(e),style:{position:"relative","margin-top":"10px"}},{default:l((()=>[i(f,{class:"btn-image",src:F}),i(D,{class:"btn-text"},{default:l((()=>[b("制造")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),i(V,{style:{"margin-top":"10px"}},{default:l((()=>[i(_,{span:5},{default:l((()=>[b(" ")])),_:1}),i(_,{span:8},{default:l((()=>[i(W,{style:{"font-size":"16px"},mark:!0,text:"金币:"+p.myPocket.coin,type:"warning",size:"default"},null,8,["text"])])),_:1}),i(_,{span:11},{default:l((()=>[i(W,{style:{"font-size":"16px"},mark:!0,text:"资源:"+p.myPocket.res,type:"warning",size:"default"},null,8,["text"])])),_:1})])),_:1})])),_:1},8,["style"])):x("",!0),1===p.menu.current||2===p.menu.current?(a(),s(P,{key:1,class:"ey-conf",style:d("max-height:"+p.page.height+"px;height:"+p.page.height+"px;")},{default:l((()=>[i(G,{"disable-touch":!0,"indicator-dots":!0,current:p.swiperIndex,style:d("max-height:"+p.page.height+"px;height:"+p.page.height+"px;")},{default:l((()=>[i(J,null,{default:l((()=>[i(H,{align:"center",type:"h2",title:"AI战斗模块",color:"#fff"}),i($,{column:4,"show-border":!1,square:!0,highlight:!1},{default:l((()=>[(a(!0),n(o,null,u(p.baseConf,((e,t)=>(a(),s(O,{index:t,key:t},{default:l((()=>[0==t||1==t||2==t||3==t||4==t||7==t||8==t||9==t||10==t||11==t?(a(),s(P,{key:0,onClick:e=>g.clickEquipConf(t),class:"grid-item-box ey-item-conf"},{default:l((()=>[p.myEquip[t]?(a(),s(y,{key:0,style:{"margin-left":"5px","margin-top":"5px"},text:"等级:"+p.myEquip[t].lvl,absolute:"rightBottom",offset:[32,15]},{default:l((()=>[i(f,{class:"btn-image",src:"/static/game/"+p.myEquip[t].avatar},null,8,["src"])])),_:2},1032,["text"])):x("",!0)])),_:2},1032,["onClick"])):(a(),s(P,{key:1,class:"grid-item-box"}))])),_:2},1032,["index"])))),128))])),_:1}),i($,{style:{"margin-top":"30px"},column:3,"show-border":!1,square:!1,highlight:!1},{default:l((()=>[(a(!0),n(o,null,u(p.baseModules,((e,t)=>(a(),s(O,{index:t,key:t},{default:l((()=>[i(P,{style:{padding:"10px"}},{default:l((()=>[i(W,{style:{"font-size":"16px"},mark:!0,text:e.name+":"+p.totalConf[e.id],type:"warning",size:"default"},null,8,["text"])])),_:2},1024)])),_:2},1032,["index"])))),128))])),_:1})])),_:1}),i(J,null,{default:l((()=>[i(H,{align:"center",type:"h2",title:"AI模块仓库",color:"#fff"}),(a(!0),n(o,null,u(p.baseModules,((e,t)=>(a(),s(V,{key:t},{default:l((()=>[i(_,{span:4,style:{"padding-top":"15px"}},{default:l((()=>[i(W,{style:{"font-size":"16px"},mark:!0,text:e.name,type:"warning",size:"default"},null,8,["text"])])),_:2},1024),p.myStoreList[e.id]?(a(!0),n(o,{key:0},u(p.myStoreList[e.id],((e,t)=>(a(),s(_,{style:{"padding-bottom":"10px"},span:4},{default:l((()=>[i(y,{onClick:t=>g.clickSelectModule(e),text:"等级:"+e.lvl,absolute:"rightBottom",offset:[23,10]},{default:l((()=>[i(y,{text:"数量:"+e.numb,type:"primary",absolute:"rightTop",offset:[-26,-45]},null,8,["text"]),i(f,{onClick:t=>g.clickSelectModule(e),class:"store-image",src:"/static/game/"+e.avatar},null,8,["onClick","src"])])),_:2},1032,["onClick","text"])])),_:2},1024)))),256)):(a(),s(_,{key:1},{default:l((()=>[b("   ")])),_:1}))])),_:2},1024)))),128))])),_:1})])),_:1},8,["current","style"])])),_:1},8,["style"])):x("",!0),3===p.menu.current?(a(),s(P,{key:2,class:"ey-fight",style:d("max-height:"+p.page.height+"px;height:"+p.page.height+"px;")},{default:l((()=>[i(D,null,{default:l((()=>[b("选项卡3的内容")])),_:1})])),_:1},8,["style"])):x("",!0),4===p.menu.current?(a(),s(P,{key:3,class:"ey-sale",style:d("color:#fff;max-height:"+p.page.height+"px;height:"+p.page.height+"px;")},{default:l((()=>[i(K,{current:p.sale.cateid,values:p.sale.cate,"style-type":"button",onClickItem:g.getSaleDataByCate},null,8,["current","values","onClickItem"]),i(P,null,{default:l((()=>[(a(!0),n(o,null,u(p.sale.data,((e,t)=>(a(),s(V,{style:{"padding-top":"10px"},key:t,index:t},{default:l((()=>[i(_,{span:1},{default:l((()=>[i(D,null,{default:l((()=>[b(" ")])),_:1})])),_:1}),i(_,{span:4},{default:l((()=>[i(f,{class:"item-image",src:"/static/game/"+e.avatar},null,8,["src"])])),_:2},1024),i(_,{span:4,style:{"padding-top":"5px"}},{default:l((()=>[i(D,null,{default:l((()=>[b("等级:"+C(e.lvl),1)])),_:2},1024)])),_:2},1024),i(_,{span:10,style:{"padding-top":"5px","padding-left":"20px"}},{default:l((()=>[i(D,null,{default:l((()=>[b("价格:"+C(e.coin)+"金币",1)])),_:2},1024)])),_:2},1024),i(_,{span:5},{default:l((()=>[e.uid==p.myInfo.uid?(a(),s(Q,{key:0,class:"mini-btn",onClick:e=>g.clickSaleModule(t),type:"primary",plain:"true",size:"mini"},{default:l((()=>[b("回购")])),_:2},1032,["onClick"])):(a(),s(Q,{key:1,class:"mini-btn",onClick:e=>g.clickSaleModule(t),type:"primary",plain:"true",size:"mini"},{default:l((()=>[b("购买")])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1032,["index"])))),128))])),_:1}),i(P,{style:{margin:"10px"}},{default:l((()=>[i(Y,{onChange:g.getSaleData,title:"","show-icon":"true",total:p.sale.count,"page-size":p.sale.limit,current:p.sale.page},null,8,["onChange","total","page-size","current"])])),_:1})])),_:1},8,["style"])):x("",!0)])),_:1}),i(P,{class:"ey-bottom"},{default:l((()=>[i(P,null,{default:l((()=>[i(K,{current:p.menu.current,values:p.menu.item,onClickItem:g.onClickMenuItem},null,8,["current","values","onClickItem"])])),_:1})])),_:1}),i(Z,{ref:"fab",content:p.actMenu,onTrigger:g.clickActMenu},null,8,["content","onTrigger"])])),_:1})}],["__scopeId","data-v-5010a672"]]);export{W as default};
